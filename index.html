<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>cosmic</title>
  <style>
    /* Basic Setup & 3D Perspective */
    body {
      margin: 0;
      height: 100vh;
      overflow: hidden;
      background: #000;
      font-family: Arial, sans-serif;
      position: relative;
      perspective: 1000px;
    }
    /* Aurora Background for extra magic */
    .aurora {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(130deg, rgba(255,0,150,0.3), rgba(0,204,255,0.3));
      filter: blur(50px);
      opacity: 0.5;
      animation: auroraMove 20s infinite alternate;
      z-index: 0;
    }
    @keyframes auroraMove {
      0% { transform: translateX(-10%) translateY(0); }
      100% { transform: translateX(10%) translateY(20%); }
    }
    /* Stars Container & Star Elements */
    .stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      pointer-events: none;
    }
    .star {
      position: absolute;
      width: 3px;
      height: 3px;
      background: #fff;
      border-radius: 50%;
      /* Stars keep twinkling in the background */
      animation: twinkle 5s infinite;
      /* Will-change for smoother transitions when we animate their positions */
      will-change: left, top, opacity;
    }
    @keyframes twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }
    /* Enhanced, Static Moon */
    .moon {
      position: absolute;
      top: 50px;
      right: 50px;
      width: 150px;
      height: 150px;
      background: radial-gradient(circle at 30% 30%, #fff, #e0e0e0 70%, #a9a9a9 100%);
      border-radius: 50%;
      box-shadow: 0 0 30px rgba(255,255,255,0.7);
      z-index: 3;
      will-change: box-shadow;
      animation: moonGlow 3s ease-in-out infinite alternate;
    }
    @keyframes moonGlow {
      0% { box-shadow: 0 0 30px rgba(255,255,255,0.7); }
      100% { box-shadow: 0 0 60px rgba(255,255,255,1); }
    }
    .moon:hover {
      box-shadow: 0 0 80px rgba(255,255,255,1);
    }
    /* A Title for your Celestial Love */
    .title {
      position: absolute;
      top: 20px;
      width: 100%;
      text-align: center;
      z-index: 4;
      color: #fff;
      font-size: 2.8em;
      text-shadow: 0 0 10px rgba(0,0,0,0.5);
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="aurora"></div>
  <div class="stars"></div>
  <div class="moon"></div>
  <div class="title">To My Celestial Love</div>

  <script>
    /***** Star Particle Setup *****/
    const starsContainer = document.querySelector('.stars');
    const starPool = [];
    const NUM_STARS = 300; // Increase this number for denser text formation
    // Create our pool of stars (they’ll be used both as background and for text formation)
    function getRandomPosition() {
      return {
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight
      };
    }
    for (let i = 0; i < NUM_STARS; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      const pos = getRandomPosition();
      star.style.left = pos.x + 'px';
      star.style.top = pos.y + 'px';
      star.style.opacity = 1;
      starPool.push(star);
      starsContainer.appendChild(star);
    }
    
    /***** Text-to-Star Mapping Functions *****/
    // Create an offscreen canvas to render the text and extract pixel positions
    function getTextTargets(message) {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      // Use full window dimensions for the text formation
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      // Adjust font size as desired
      ctx.font = 'bold 100px Arial';
      ctx.fillStyle = '#fff';
      ctx.fillText(message, canvas.width / 2, canvas.height / 2);
      
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imageData.data;
      const targets = [];
      const step = 6; // Increase step for fewer points (lower resolution)
      for (let y = 0; y < canvas.height; y += step) {
        for (let x = 0; x < canvas.width; x += step) {
          const index = (y * canvas.width + x) * 4;
          if (data[index + 3] > 128) { // If pixel is not transparent
            targets.push({ x, y });
          }
        }
      }
      return targets;
    }
    
    // Randomly shuffle an array (Fisher–Yates shuffle)
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    
    /***** Animation: Form Text Using Stars, Then Disperse *****/
    async function animateTextFormation(message) {
      // Get the target positions for the given message
      let targets = getTextTargets(message);
      // Shuffle targets so we get a varied distribution
      targets = shuffle(targets);
      // Determine how many stars will be used (limited by our star pool)
      const numTargets = Math.min(starPool.length, targets.length);
      
      // Animate stars to form the text
      for (let i = 0; i < numTargets; i++) {
        const star = starPool[i];
        // Use CSS transition for smooth movement
        star.style.transition = 'all 2s ease-out';
        star.style.left = targets[i].x + 'px';
        star.style.top = targets[i].y + 'px';
        star.style.opacity = 1;
      }
      // Optional: fade out unused stars (if any)
      for (let i = numTargets; i < starPool.length; i++) {
        const star = starPool[i];
        star.style.transition = 'all 2s ease-out';
        star.style.opacity = 0;
      }
      // Wait for the formation to complete and be held
      await new Promise(resolve => setTimeout(resolve, 2200));
      // Hold the formed text for a moment (e.g. 2 seconds)
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      // Disperse: Animate all stars back to random positions
      for (let star of starPool) {
        star.style.transition = 'all 2s ease-out';
        const pos = getRandomPosition();
        star.style.left = pos.x + 'px';
        star.style.top = pos.y + 'px';
        // Ensure they’re visible
        star.style.opacity = 1;
      }
      // Wait for dispersion to finish
      await new Promise(resolve => setTimeout(resolve, 2200));
    }
    
    /***** Loop Through Messages Continuously *****/
    const messages = [
      "In this vast cosmic dance of stars and moons, you are my universe's brightest light.",
      "Like the eternal moon that graces our night sky, your presence fills my world with wonder.",
      "Just as the moon pulls the tides, your soul has an inexplicable power over my heart.",
      "Through the darkest nights and stormiest seas, your light remains unwavering.",
      "Remember, my love - like the moon's phases, life's challenges are temporary.",
      "Your spirit, as boundless as the cosmos itself, cannot be contained.",
      "In moments when the world feels heavy, look up at our shared moon.",
      "Know that somewhere, I'm gazing at the same celestial guardian.",
      "Until our paths converge again under the moonlit sky, you are cherished beyond measure.",
      "Across the endless night, our hearts speak in the language of the stars.",
      "Every phase of the moon reminds me of our ever-changing yet eternal love.",
      "In the quiet solitude of space, your love is the melody that guides me."
    ];
    let currentIndex = 0;
    
    async function showMessages() {
      while (true) {
        await animateTextFormation(messages[currentIndex]);
        currentIndex = (currentIndex + 1) % messages.length;
        // Brief pause between messages
        await new Promise(resolve => setTimeout(resolve, 1000));
      }
    }
    
    // Start the star-based text formation after a short delay
    setTimeout(showMessages, 2000);
  </script>
</body>
</html>
